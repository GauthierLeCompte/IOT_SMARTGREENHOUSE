version: '3.6'
networks:
  iot_net:
    driver: bridge
services:

  api:
    build:
      context: ./api
      dockerfile: DockerFile
    volumes:
    - './api:/usr/src/app'
    ports:
      - 5001:5000
#    expose:
#      - '5000'
    environment:
    - FLASK_DEBUG=1
    - APP_SETTINGS=src.config.DevelopmentConfig
    container_name: api
    networks:
      - iot_net
    depends_on:
      - iot_database
      - model

  model:
    ports:
      - 5002:5000
    expose:
      - '5000'
    build:
      context: ./model
      dockerfile: DockerFile
    volumes:
      - './model:/usr/src/app'
    environment:
      - FLASK_DEBUG=1
      - APP_SETTINGS=src.config.DevelopmentConfig
    depends_on:
      - iot_database
    container_name: model
    networks:
      - iot_net

  iot_database:
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
    ports:
      - 5435:5432
    build:
      context: ./database
      dockerfile: DockerFile
    container_name: iot_db
    networks:
      - iot_net

#  nginx:
#    build:
#      context: ./nginx
#      dockerfile: DockerFile
#    restart: always
#    ports:
#      - 80:80
#    depends_on:
#      - iot_database
#      - model
#      - api


